<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API文档 - KeyHub</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="/static/css/docs.css">
    <!-- Google Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Fira+Code:wght@400;500&display=swap"
        rel="stylesheet">
</head>

<body>
    <div class="docs-container">
        <!-- Header -->
        <header class="docs-header">
            <div class="logo">
                <h1>KeyHub</h1>
                <span class="badge">API文档</span>
            </div>

            <nav class="nav-menu">
                <a href="/" class="nav-link">密钥管理</a>
                <a href="/admin" class="nav-link">管理员管理</a>
                <a href="/docs" class="nav-link active">API文档</a>
            </nav>

            <div class="user-actions">
                <a href="/" class="btn-text">← 返回首页</a>
            </div>
        </header>

        <div class="docs-layout">
            <!-- Sidebar -->
            <aside class="docs-sidebar">
                <nav class="docs-nav">
                    <h3>目录</h3>
                    <ul>
                        <li><a href="#overview">概述</a></li>
                        <li><a href="#verify-api">验证接口</a></li>
                        <li><a href="#register-api">注册接口</a></li>
                        <li><a href="#integration">集成指南</a></li>
                    </ul>
                </nav>
            </aside>

            <!-- Main Content -->
            <main class="docs-content">
                <section id="overview">
                    <h1>KeyHub API 文档</h1>
                    <p class="lead">KeyHub 是一个简单易用的授权密钥管理系统，支持多项目管理、自定义密钥格式和客户端自助注册。</p>
                    
                    <div class="info-box">
                        <h3>基础信息</h3>
                        <ul>
                            <li><strong>Base URL:</strong> <code>http://your-domain.com</code></li>
                            <li><strong>数据格式:</strong> <code>application/json</code></li>
                            <li><strong>字符编码:</strong> <code>UTF-8</code></li>
                        </ul>
                    </div>
                </section>

                <section id="verify-api">
                    <h2>🔐 验证接口</h2>
                    <p>验证授权密钥是否在指定项目下有效。此接口用于客户端验证授权状态。</p>

                    <div class="api-endpoint">
                        <div class="endpoint-header">
                            <span class="method post">POST</span>
                            <code class="endpoint-url">/api/verify</code>
                        </div>
                        <p class="endpoint-desc">验证密钥在指定项目下的有效性</p>
                    </div>

                    <h3>请求参数</h3>
                    <div class="table-wrapper">
                        <table class="params-table">
                            <thead>
                                <tr>
                                    <th>参数名</th>
                                    <th>类型</th>
                                    <th>必填</th>
                                    <th>说明</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>key</code></td>
                                    <td>String</td>
                                    <td>是</td>
                                    <td>授权密钥（可以是自动生成的 KH-XXXXXXXX-XXXXXXXX 格式或自定义密钥）</td>
                                </tr>
                                <tr>
                                    <td><code>project_name</code></td>
                                    <td>String</td>
                                    <td>是</td>
                                    <td>项目名称（必须与密钥所属的项目名称一致）</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <h3>请求示例</h3>
                    <div class="code-block">
                        <div class="code-header">
                            <span>JSON</span>
                            <button class="copy-btn" onclick="copyCode(this)">复制</button>
                        </div>
                        <pre><code>{
    "key": "KH-A1B2C3D4-E5F6G7H8",
    "project_name": "Default Project"
}</code></pre>
                    </div>

                    <h3>响应参数</h3>
                    <div class="table-wrapper">
                        <table class="params-table">
                            <thead>
                                <tr>
                                    <th>字段名</th>
                                    <th>类型</th>
                                    <th>说明</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>valid</code></td>
                                    <td>Boolean</td>
                                    <td>验证结果（<code>true</code> 表示有效，<code>false</code> 表示无效）</td>
                                </tr>
                                <tr>
                                    <td><code>message</code></td>
                                    <td>String</td>
                                    <td>提示信息（中文）</td>
                                </tr>
                                <tr>
                                    <td><code>project_name</code></td>
                                    <td>String</td>
                                    <td>项目名称（仅在验证成功时返回）</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <h3>响应示例</h3>

                    <h4>✅ 验证成功</h4>
                    <div class="status-badge success">状态码: 200 OK</div>
                    <div class="code-block">
                        <div class="code-header">
                            <span>JSON</span>
                            <button class="copy-btn" onclick="copyCode(this)">复制</button>
                        </div>
                        <pre><code>{
    "valid": true,
    "message": "验证通过",
    "project_name": "Default Project"
}</code></pre>
                    </div>

                    <h4>❌ 验证失败 - 密钥不存在</h4>
                    <div class="status-badge error">状态码: 404 Not Found</div>
                    <div class="code-block">
                        <div class="code-header">
                            <span>JSON</span>
                            <button class="copy-btn" onclick="copyCode(this)">复制</button>
                        </div>
                        <pre><code>{
    "valid": false,
    "message": "未找到该密钥在此项目下的授权"
}</code></pre>
                    </div>

                    <h4>❌ 验证失败 - 授权已禁用</h4>
                    <div class="status-badge error">状态码: 403 Forbidden</div>
                    <div class="code-block">
                        <div class="code-header">
                            <span>JSON</span>
                            <button class="copy-btn" onclick="copyCode(this)">复制</button>
                        </div>
                        <pre><code>{
    "valid": false,
    "message": "授权已禁用"
}</code></pre>
                    </div>

                    <h4>❌ 验证失败 - 参数错误</h4>
                    <div class="status-badge error">状态码: 400 Bad Request</div>
                    <div class="code-block">
                        <div class="code-header">
                            <span>JSON</span>
                            <button class="copy-btn" onclick="copyCode(this)">复制</button>
                        </div>
                        <pre><code>{
    "valid": false,
    "message": "密钥不能为空"
}</code></pre>
                    </div>

                    <div class="warning-box">
                        <strong>⚠️ 重要提示</strong>
                        <ul>
                            <li>验证时必须同时提供 <code>key</code> 和 <code>project_name</code> 参数</li>
                            <li>系统会验证密钥是否属于指定的项目，如果密钥存在但不属于该项目，将返回 404 错误</li>
                            <li>只有密钥状态为"已激活"时才会验证通过</li>
                        </ul>
                    </div>
                </section>

                <section id="register-api">
                    <h2>📝 注册接口</h2>
                    <p>客户端用户自助注册接口，无需管理员权限。用于客户端首次注册授权密钥。</p>

                    <div class="api-endpoint">
                        <div class="endpoint-header">
                            <span class="method post">POST</span>
                            <code class="endpoint-url">/api/register</code>
                        </div>
                        <p class="endpoint-desc">客户端自助注册授权密钥（公开接口，无需认证）</p>
                    </div>

                    <h3>请求参数</h3>
                    <div class="table-wrapper">
                        <table class="params-table">
                            <thead>
                                <tr>
                                    <th>参数名</th>
                                    <th>类型</th>
                                    <th>必填</th>
                                    <th>说明</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>key</code> 或 <code>custom_key</code></td>
                                    <td>String</td>
                                    <td>是</td>
                                    <td>授权密钥（支持任意格式，如手机号、邮箱、随机字符串等）</td>
                                </tr>
                                <tr>
                                    <td><code>project_name</code></td>
                                    <td>String</td>
                                    <td>是</td>
                                    <td>项目名称（必须与后台创建的项目名称完全一致）</td>
                                </tr>
                                <tr>
                                    <td><code>remarks</code></td>
                                    <td>String</td>
                                    <td>否</td>
                                    <td>备注信息（如"VIP用户"、"企业授权"等）</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <h3>请求示例</h3>
                    <div class="code-block">
                        <div class="code-header">
                            <span>JSON</span>
                            <button class="copy-btn" onclick="copyCode(this)">复制</button>
                        </div>
                        <pre><code>// 使用自动生成的密钥格式
{
    "key": "KH-A1B2C3D4-E5F6G7H8",
    "project_name": "Default Project",
    "remarks": "企业授权"
}

// 使用手机号作为密钥
{
    "key": "13800138000",
    "project_name": "Mobile App",
    "remarks": "VIP用户"
}

// 使用邮箱作为密钥
{
    "key": "user@example.com",
    "project_name": "Web Portal",
    "remarks": "个人用户"
}</code></pre>
                    </div>

                    <h3>响应示例</h3>

                    <h4>✅ 注册成功</h4>
                    <div class="status-badge success">状态码: 201 Created</div>
                    <div class="code-block">
                        <div class="code-header">
                            <span>JSON</span>
                            <button class="copy-btn" onclick="copyCode(this)">复制</button>
                        </div>
                        <pre><code>{
    "success": true,
    "key": "KH-A1B2C3D4-E5F6G7H8",
    "message": "注册成功"
}</code></pre>
                    </div>

                    <h4>❌ 注册失败 - 密钥已存在</h4>
                    <div class="status-badge error">状态码: 409 Conflict</div>
                    <div class="code-block">
                        <div class="code-header">
                            <span>JSON</span>
                            <button class="copy-btn" onclick="copyCode(this)">复制</button>
                        </div>
                        <pre><code>{
    "success": false,
    "message": "该密钥在此项目中已存在"
}</code></pre>
                    </div>

                    <h4>❌ 注册失败 - 项目不存在</h4>
                    <div class="status-badge error">状态码: 404 Not Found</div>
                    <div class="code-block">
                        <div class="code-header">
                            <span>JSON</span>
                            <button class="copy-btn" onclick="copyCode(this)">复制</button>
                        </div>
                        <pre><code>{
    "success": false,
    "message": "指定的项目不存在"
}</code></pre>
                    </div>

                    <div class="info-box">
                        <h3>💡 使用说明</h3>
                        <ul>
                            <li>此接口为公开接口，无需任何认证即可调用</li>
                            <li>同一项目下，密钥必须唯一（不能重复注册）</li>
                            <li>密钥格式完全自定义，可以是手机号、邮箱、随机字符串等任意格式</li>
                            <li>注册成功后，密钥状态默认为"已激活"</li>
                        </ul>
                    </div>
                </section>

                <section id="integration">
                    <h2>🚀 集成指南</h2>

                    <h3>验证流程</h3>
                    <div class="steps-box">
                        <ol>
                            <li><strong>获取密钥和项目名</strong>：从用户输入或配置文件中获取授权密钥和项目名称</li>
                            <li><strong>调用验证接口</strong>：向 <code>/api/verify</code> 发送 POST 请求，包含 <code>key</code> 和 <code>project_name</code></li>
                            <li><strong>处理响应</strong>：根据返回的 <code>valid</code> 字段判断验证结果</li>
                            <li><strong>错误处理</strong>：处理网络错误、超时等异常情况</li>
                        </ol>
                    </div>

                    <h3>最佳实践</h3>
                    <div class="tips-box">
                        <ul>
                            <li><strong>验证时机</strong>：建议在应用启动时验证一次，之后根据业务需要定期验证（如每天、每周）</li>
                            <li><strong>缓存结果</strong>：验证成功后可以缓存结果，避免频繁请求服务器</li>
                            <li><strong>错误处理</strong>：实现合理的重试机制和降级策略，确保网络异常时不影响用户体验</li>
                            <li><strong>安全性</strong>：不要在客户端代码中硬编码密钥，建议从配置文件或环境变量读取</li>
                            <li><strong>项目名称</strong>：确保项目名称与后台创建的项目名称完全一致（区分大小写）</li>
                        </ul>
                    </div>

                    <h3>密钥格式建议</h3>
                    <div class="info-box">
                        <ul>
                            <li><strong>自动生成格式</strong>：<code>KH-XXXXXXXX-XXXXXXXX</code> - 适合软件授权</li>
                            <li><strong>手机号</strong>：<code>13800138000</code> - 适合移动应用</li>
                            <li><strong>邮箱</strong>：<code>user@example.com</code> - 适合Web应用</li>
                            <li><strong>自定义字符串</strong>：任意格式 - 根据业务需求自定义</li>
                        </ul>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <script>
        function copyCode(button) {
            const codeBlock = button.closest('.code-block').querySelector('code');
            const text = codeBlock.textContent;

            navigator.clipboard.writeText(text).then(() => {
                const originalText = button.textContent;
                button.textContent = '已复制!';
                button.style.background = 'var(--success-color)';

                setTimeout(() => {
                    button.textContent = originalText;
                    button.style.background = '';
                }, 2000);
            }).catch(err => {
                console.error('复制失败:', err);
            });
        }

        // Smooth scroll for anchor links
        document.querySelectorAll('.docs-nav a').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            });
        });
    </script>
</body>

</html>
