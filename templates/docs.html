<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API文档 - KeyHub</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="/static/css/docs.css">
    <!-- Google Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Fira+Code:wght@400;500&display=swap"
        rel="stylesheet">
</head>

<body>
    <div class="docs-container">
        <!-- Header -->
        <header class="docs-header">
            <div class="logo">
                <h1>KeyHub</h1>
                <span class="badge">API文档</span>
            </div>

            <nav class="nav-menu">
                <a href="/" class="nav-link">密钥管理</a>
                <a href="/admin" class="nav-link">管理员管理</a>
                <a href="/docs" class="nav-link active">API文档</a>
            </nav>

            <div class="user-actions">
                <a href="/" class="btn-text">← 返回首页</a>
            </div>
        </header>

        <div class="docs-layout">
            <!-- Sidebar -->
            <aside class="docs-sidebar">
                <nav class="docs-nav">
                    <h3>目录</h3>
                    <ul>
                        <li><a href="#overview">概述</a></li>
                        <li><a href="#verify-api">验证接口</a></li>
                        <li><a href="#request-params">请求参数</a></li>
                        <li><a href="#request-example">请求示例</a></li>
                        <li><a href="#response-params">返回参数</a></li>
                        <li><a href="#response-examples">响应示例</a></li>
                        <li><a href="#admin-api">用户注册接口</a></li>
                        <li><a href="#integration">集成建议</a></li>
                    </ul>
                </nav>
            </aside>

            <!-- Main Content -->
            <main class="docs-content">
                <section id="overview">
                    <h1>KeyHub 客户端 API 文档</h1>
                    <p class="lead">本文档详细介绍了如何集成 KeyHub 授权验证接口。</p>
                </section>

                <section id="verify-api">
                    <h2>验证接口 (Verify API)</h2>
                    <p>用于验证客户端授权 Key 并绑定当前机器。</p>

                    <div class="info-box">
                        <h3>接口信息</h3>
                        <ul>
                            <li><strong>地址:</strong> <code>POST /api/verify</code></li>
                            <li><strong>数据格式:</strong> <code>application/json</code></li>
                        </ul>
                    </div>
                </section>

                <section id="request-params">
                    <h2>请求参数</h2>
                    <div class="table-wrapper">
                        <table class="params-table">
                            <thead>
                                <tr>
                                    <th>参数名</th>
                                    <th>类型</th>
                                    <th>必填</th>
                                    <th>说明</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>key</code></td>
                                    <td>String</td>
                                    <td>是</td>
                                    <td>授权密钥 (格式: <code>KH-XXXXXXXX-XXXXXXXX</code>)</td>
                                </tr>
                                <tr>
                                    <td><code>machine_id</code></td>
                                    <td>String</td>
                                    <td>是</td>
                                    <td>机器硬件指纹/唯一标识符(客户端生成)</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>

                <section id="request-example">
                    <h2>请求示例 (JSON)</h2>
                    <div class="code-block">
                        <div class="code-header">
                            <span>JSON</span>
                            <button class="copy-btn" onclick="copyCode(this)">复制</button>
                        </div>
                        <pre><code>{
    "key": "KH-A1B2C3D4-E5F6G7H8",
    "machine_id": "CPU-8888-9999-UUID"
}

// 自定义密钥示例
{
    "key": "13800138000",
    "machine_id": "CPU-8888-9999-UUID"
}</code></pre>
                    </div>
                </section>

                <section id="response-params">
                    <h2>返回参数说明</h2>
                    <p>返回 JSON 格式数据：</p>
                    <div class="table-wrapper">
                        <table class="params-table">
                            <thead>
                                <tr>
                                    <th>字段名</th>
                                    <th>类型</th>
                                    <th>说明</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>valid</code></td>
                                    <td>Boolean</td>
                                    <td>验证是否通过 (<code>true</code> 表示授权有效，<code>false</code> 表示授权无效)</td>
                                </tr>
                                <tr>
                                    <td><code>message</code></td>
                                    <td>String</td>
                                    <td>提示信息 (中文)</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>

                <section id="response-examples">
                    <h2>响应示例</h2>

                    <h3>1. 验证成功 (新绑定)</h3>
                    <div class="status-badge success">状态码: 200 OK</div>
                    <div class="code-block">
                        <div class="code-header">
                            <span>JSON</span>
                            <button class="copy-btn" onclick="copyCode(this)">复制</button>
                        </div>
                        <pre><code>{
    "valid": true,
    "message": "验证通过 (新绑定已创建)"
}</code></pre>
                    </div>

                    <h3>2. 验证成功 (已绑定机器)</h3>
                    <div class="status-badge success">状态码: 200 OK</div>
                    <div class="code-block">
                        <div class="code-header">
                            <span>JSON</span>
                            <button class="copy-btn" onclick="copyCode(this)">复制</button>
                        </div>
                        <pre><code>{
    "valid": true,
    "message": "验证通过 (已绑定)"
}</code></pre>
                    </div>

                    <h3>3. 验证失败 (密钥不存在)</h3>
                    <div class="status-badge error">状态码: 404 Not Found</div>
                    <div class="code-block">
                        <div class="code-header">
                            <span>JSON</span>
                            <button class="copy-btn" onclick="copyCode(this)">复制</button>
                        </div>
                        <pre><code>{
    "valid": false,
    "message": "未找到密钥"
}</code></pre>
                    </div>

                    <h3>4. 验证失败 (密钥被禁用)</h3>
                    <div class="status-badge error">状态码: 403 Forbidden</div>
                    <div class="code-block">
                        <div class="code-header">
                            <span>JSON</span>
                            <button class="copy-btn" onclick="copyCode(this)">复制</button>
                        </div>
                        <pre><code>{
    "valid": false,
    "message": "密钥已禁用"
}</code></pre>
                    </div>
                </section>

                <section id="admin-api">
                    <h2>用户注册接口 (公开)</h2>
                    <p>用于客户端用户自助注册，无需管理员权限。</p>

                    <div class="info-box">
                        <h3>接口信息</h3>
                        <ul>
                            <li><strong>地址:</strong> <code>POST /api/register</code></li>
                            <li><strong>认证:</strong> 无需认证（公开接口）</li>
                            <li><strong>数据格式:</strong> <code>application/json</code></li>
                        </ul>
                    </div>

                    <h3>请求参数</h3>
                    <div class="table-wrapper">
                        <table class="params-table">
                            <thead>
                                <tr>
                                    <th>参数名</th>
                                    <th>类型</th>
                                    <th>必填</th>
                                    <th>说明</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>key</code> 或 <code>custom_key</code></td>
                                    <td>String</td>
                                    <td>是</td>
                                    <td>用户密钥（可以是手机号、用户ID、邮箱等）</td>
                                </tr>
                                <tr>
                                    <td><code>project_name</code></td>
                                    <td>String</td>
                                    <td>是</td>
                                    <td>项目名称（必须指定，使用项目名代替项目ID）</td>
                                </tr>
                                <tr>
                                    <td><code>remarks</code></td>
                                    <td>String</td>
                                    <td>否</td>
                                    <td>备注信息（如用户昵称）</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <h3>请求示例</h3>
                    <div class="code-block">
                        <div class="code-header">
                            <span>JSON</span>
                            <button class="copy-btn" onclick="copyCode(this)">复制</button>
                        </div>
                        <pre><code>// 使用手机号注册指定项目
{
    "key": "13800138000",
    "project_name": "Default Project",
    "remarks": "张三"
}

// 使用用户ID注册并指定项目
{
    "custom_key": "user_12345",
    "project_name": "Mobile App",
    "remarks": "VIP用户"
}

// 使用邮箱注册
{
    "key": "user@example.com",
    "project_name": "Web Portal",
    "remarks": "企业用户"
}</code></pre>
                    </div>

                    <h3>响应示例</h3>
                    <div class="status-badge success">状态码: 201 Created（注册成功）</div>
                    <div class="code-block">
                        <div class="code-header">
                            <span>JSON</span>
                            <button class="copy-btn" onclick="copyCode(this)">复制</button>
                        </div>
                        <pre><code>{
    "success": true,
    "key": "13800138000",
    "message": "注册成功"
}</code></pre>
                    </div>

                    <div class="status-badge error">状态码: 409 Conflict（用户已存在）</div>
                    <div class="code-block">
                        <div class="code-header">
                            <span>JSON</span>
                            <button class="copy-btn" onclick="copyCode(this)">复制</button>
                        </div>
                        <pre><code>{
    "message": "该用户已注册（密钥已存在）"
}</code></pre>
                    </div>

                    <div class="status-badge error">状态码: 400 Bad Request（参数错误）</div>
                    <div class="code-block">
                        <div class="code-header">
                            <span>JSON</span>
                            <button class="copy-btn" onclick="copyCode(this)">复制</button>
                        </div>
                        <pre><code>{
    "message": "密钥不能为空"
}</code></pre>
                    </div>

                    <div class="status-badge error">状态码: 404 Not Found（项目不存在）</div>
                    <div class="code-block">
                        <div class="code-header">
                            <span>JSON</span>
                            <button class="copy-btn" onclick="copyCode(this)">复制</button>
                        </div>
                        <pre><code>{
    "message": "指定的项目不存在"
}</code></pre>
                    </div>
                </section>

                <section id="integration">
                    <h2>集成建议</h2>
                    <div class="tips-box">
                        <ol>
                            <li><strong>机器码获取:</strong> 建议使用 CPU ID 或 主板序列号生成的哈希值作为 <code>machine_id</code>。</li>
                            <li><strong>用户注册:</strong> 客户端可以使用 <code>/api/register</code>
                                接口让用户自助注册，使用手机号、邮箱或用户ID作为密钥。验证逻辑在客户端自行实现。</li>
                            <li><strong>频率控制:</strong> 验证请求不宜过于频繁，建议在程序启动时验证一次，之后每隔数小时在后台静默验证。</li>
                            <li><strong>超时处理:</strong> 客户端应处理网络超时或服务器宕机的情况，建议在这种情况下设置一定的宽限期。</li>
                        </ol>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <script>
        function copyCode(button) {
            const codeBlock = button.closest('.code-block').querySelector('code');
            const text = codeBlock.textContent;

            navigator.clipboard.writeText(text).then(() => {
                const originalText = button.textContent;
                button.textContent = '已复制!';
                button.style.background = 'var(--success-color)';

                setTimeout(() => {
                    button.textContent = originalText;
                    button.style.background = '';
                }, 2000);
            }).catch(err => {
                console.error('复制失败:', err);
            });
        }

        // Smooth scroll for anchor links
        document.querySelectorAll('.docs-nav a').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            });
        });
    </script>
</body>

</html>